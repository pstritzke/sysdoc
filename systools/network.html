<!DOCTYPE html>
<html dir="ltr" lang="en">
    <head>
        <meta charset='utf-8'>
        <title>Network</title>
    </head>
    <body>
        <h1>Network</h1>
        
        <pre>
        ? exim
        o sshd
        o dnsmasq
        ? squid
        o nginx
        ? postgresql
        ? php-fpm
        ? tor
        </pre>
       
        <p>resolv.conf</p>

        <pre>
        192.168.1.65
        127.0.0.1
        8.8.8.8
        
        $chattr +i resolv.conf
        </pre>

        <h2 id="iptables">IPtables</h2>

        <p>You can use this <a href="../src/bash/iptables/iptables.sh">script</a> 
        at boot time or tools iptables-save and iptables-restore. To setup this 
        tools at boot time, use iptables-save to create a file based on 
        rules generated by this script;</p>

        <pre>
        # mkdir /etc/iptables
        # cp /home/user/sysdoc/src/bash/iptables/iptables.sh /etc/iptables/
        </pre>

        <p>Adjust iptables to your needs, then;</p>
        <pre>
        # cd /etc/iptables
        # sh iptables.sh
        # iptables-save > rules.v4 
        </pre>

        <p>Copy init script, edit if you dont like to
        let drop when you call stop.</p>

        <pre>
        # cp /home/user/sysdoc/conf/etc/rc.d/iptables /etc/rc.d/
        # vim /etc/rc.d/iptables
        # chmod +x /etc/rc.d/iptables
        </pre>

        <p>Sysctl settings from <a href="http://www.cyberciti.biz/tips/linux-unix-bsd-nginx-webserver-security.html">Cyberciti Nginx Hardning</a>
        and <a href="http://www.cyberciti.biz/faq/linux-kernel-etcsysctl-conf-security-hardening/">Cyberciti Security Hardening</a>
        edit /etc/sysctl.conf;</p>

        <pre>
        # Avoid a smurf attack
        net.ipv4.icmp_echo_ignore_broadcasts = 1
         
        # Turn on protection for bad icmp error messages
        net.ipv4.icmp_ignore_bogus_error_responses = 1
         
        # Turn on syncookies for SYN flood attack protection
        net.ipv4.tcp_syncookies = 1
         
        # Turn on and log spoofed, source routed, and redirect packets
        net.ipv4.conf.all.log_martians = 1
        net.ipv4.conf.default.log_martians = 1
         
        # No source routed packets here
        net.ipv4.conf.all.accept_source_route = 0
        net.ipv4.conf.default.accept_source_route = 0
         
        # Turn on reverse path filtering
        net.ipv4.conf.all.rp_filter = 1
        net.ipv4.conf.default.rp_filter = 1
         
        # Make sure no one can alter the routing tables
        net.ipv4.conf.all.accept_redirects = 0
        net.ipv4.conf.default.accept_redirects = 0
        net.ipv4.conf.all.secure_redirects = 0
        net.ipv4.conf.default.secure_redirects = 0
         
        # Don't act as a router
        net.ipv4.ip_forward = 0
        net.ipv4.conf.all.send_redirects = 0
        net.ipv4.conf.default.send_redirects = 0
          
        # Turn on execshild
        kernel.exec-shield = 1
        kernel.randomize_va_space = 1
         
        # Tuen IPv6
        net.ipv6.conf.default.router_solicitations = 0
        net.ipv6.conf.default.accept_ra_rtr_pref = 0
        net.ipv6.conf.default.accept_ra_pinfo = 0
        net.ipv6.conf.default.accept_ra_defrtr = 0
        net.ipv6.conf.default.autoconf = 0
        net.ipv6.conf.default.dad_transmits = 0
        net.ipv6.conf.default.max_addresses = 1
         
        # Optimization for port usefor LBs
        # Increase system file descriptor limit
        fs.file-max = 65535
         
        # Allow for more PIDs (to reduce rollover problems); may break some programs 32768
        kernel.pid_max = 65536
         
        # Increase system IP port limits
        net.ipv4.ip_local_port_range = 2000 65000
         
        # Increase TCP max buffer size setable using setsockopt()
        net.ipv4.tcp_rmem = 4096 87380 8388608
        net.ipv4.tcp_wmem = 4096 87380 8388608
         
        # Increase Linux auto tuning TCP buffer limits
        # min, default, and max number of bytes to use
        # set max to at least 4MB, or higher if you use very high BDP paths
        # Tcp Windows etc
        net.core.rmem_max = 8388608
        net.core.wmem_max = 8388608
        net.core.netdev_max_backlog = 5000
        net.ipv4.tcp_window_scaling = 1
        </pre>

        <p>Load new settings;</p>

        <pre>
        # sysctl -p
        </pre>

        <h2 id="wireless">Wireless</h2>

        <p>There is more information on
        <a href="http://crux.nu/Wiki/WifiStartScripts">Wiki Wifi Start Scripts</a>.</p>

        <pre>
        # ip link
        </pre>

        <pre>
        # iwlist wlp2s0 scan
        </pre>

        <pre>
        # iwconfig wlp2s0 essid NAME key s:ABCDE12345
        </pre>
        
        <pre>
        # ip addr add 192.168.1.65 dev wlp2s0
        </pre>

        <h3 id="wpa">Wpa Supplicant</h3>

        <p>Configure wpa supplicant edit;</p>

        <pre>
        # vim /etc/wpa_supplicant.conf
        </pre>

        <pre>
        ctrl_interface=/var/run/wpa_supplicant
        update_config=1
        fast_reauth=1
        ap_scan=1
        </pre>

        <pre>
        # wpa_passphrase &lt;ssid&gt; &lt;password&gt; &gt;&gt; /etc/wpa_supplicant.conf
        </pre>

        <p>Now start wpa_supplicant with:</p>

        <pre>
        # wpa_supplicant -B -i wlp2s0 -c /etc/wpa_supplicant.conf
        Successfully initialized wpa_supplicant
        </pre>

        
        <p>Example how to configure with static ip. You
        don't need this if you use dhcpd</p>

        <pre>
        # vim /etc/rc.d/net
        </pre>

        <pre>
        case $1 in
            start)

            /usr/sbin/wpa_supplicant -B -i ${DEV} -c /etc/wpa_supplicant.conf

            if [ "${TYPE}" == "DHCP" ]; then
        </pre>

        <pre>
        stop)

            killall wpa_supplicant

            if [ "${TYPE}" == "DHCP" ]; then
        </pre>

        <h4 id="wpa">Wpa Cli</h4>

        <pre>
        # wpa_cli
        > status
        </pre>

        <pre>
        > add_network
        3
        </pre>

        <pre>
        > set_network 3 ssid "Valcovo-Network"
        OK
        </pre>

        <pre>
        > set_network 3 psk "uber-secret-pass"
        OK
        </pre>

        <pre>
        > enable_network 3
        OK
        </pre>

        <pre>
        > list_networks
        </pre>
        
        <pre>
        > select_network 3
        </pre>

        <pre>
        > save_config
        </pre>

    </body>
</html>
